<?xml version="1.0" encoding="utf-8"?>
<!--
Copyright (c) 2008 Andrew Rapp. All rights reserved.
 
This file is part of XBee-API.
 
XBee-API is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.
 
XBee-API is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
 
You should have received a copy of the GNU General Public License
along with XBee-API.  If not, see <http://www.gnu.org/licenses/>.

TODO provide bin, src, and examples distributions
 -->
<project default="compile" name="XBee-API">
	<property file="build.properties"/>
	<property name="build.dir" value="build"/>
	<property name="src.dir" value="src"/>
	<property name="lib.dir" value="lib"/>
	<property name="dist.dir" value="dist"/>

   	<path id="compile-classpath">
		<fileset dir="${lib.dir}">
			<include name="**/*.jar"/>
		</fileset>
	</path>
	
	<target name="init">
		<mkdir dir="${build.dir}"/>
		<mkdir dir="${dist.dir}"/>
	</target>
	
	<target name="compile" depends="init">

    		<available property="jdk1.3+" classname="java.lang.StrictMath"/>
    		<available property="jdk1.4+" classname="java.lang.CharSequence"/>
    		<available property="jdk1.5+" classname="java.lang.Readable"/>
    
  		<fail unless="jdk1.5+" message="This software requires Java 1.5.  Please obtain the Java 1.5 SDK, update your JAVA_HOME, and try again"/>
  		
		<javac 
			classpathref="compile-classpath" 
			debug="true" 
			destdir="${build.dir}" 
			srcdir="${src.dir}" 
			failonerror="true">
			<include name="*/**"/>
		</javac>
	</target>
	
	<target name="dist" depends="compile">
		
		<jar basedir="${build.dir}" destfile="${dist.dir}/xbee-api.jar"/>
		
		<!-- copy thirdparty libs -->
		<copy todir="${dist.dir}/lib">
			<fileset dir="${lib.dir}">
				<include name="*.jar"/>
			</fileset>
		</copy>

		<!-- copy rxtx native lib -->
		<copy todir="${dist.dir}">
			<fileset dir=".">
				<include name="*.jnilib"/>
				<include name="*.dll"/>
				<include name="*.so"/>
				<include name=".classpath"/>
				<include name=".project"/>
				<include name="COPYING"/>
			</fileset>
		</copy>
		
		<copy file="log4j.properties" todir="${dist.dir}"/>

		<copy todir="${dist.dir}/src">
			<fileset dir="src">
				<exclude name="svn*"/>
			</fileset>
		</copy>

		<copy todir="${dist.dir}/resources">
			<fileset dir="resources">
				<include name="XBee-*manual.pdf"/>
			</fileset>
		</copy>
	
		<zip basedir="${dist.dir}" destfile="xbee-api-0.3.2.zip"/>
	</target>
	
	<target name="clean">
		<delete includeEmptyDirs="yes" failonerror="no">
			<fileset dir="${build.dir}" includes="**/*"/>
			<fileset dir="${dist.dir}" includes="**/*"/>
		</delete>
	</target>
		
</project>
